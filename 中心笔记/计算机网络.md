## 计算机网络的概念

计算机网络(computer networking)是一个将众多分散的、自治的计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现资源共享和信息传递的系统。由若干结点(node,可以是计算机、集线器、交换机、路由器等)和连接这些结点的链路(link,链路可以是有线链路、无线链路)组成。

集线器和交换机都是将多台电脑链接为一个计算机网络,路由器则是负责将多个计算机网络连接在一起形成一个更大的计算机网络(此时都可以称为互连网),同时也负责了一部分的负载均衡

互联网(或因特网，Internet):由各大ISP(互连网服务提供商)和国际机构组建的，覆盖全球范围的互连网(internet)

互联网必须使用TCP/IP协议通信，互连网可使用任意协议通信

## 计算机网络的组成和功能

![[Pasted image 20250715135748.png]]

![[Pasted image 20250715135755.png]]

![[Pasted image 20250715135802.png]]

![[Pasted image 20250715135808.png]]

![[Pasted image 20250715135814.png]]

## 数据交换技术

![[Pasted image 20250715135820.png]]

#### 电路交换

电路交换(Circuit Switching):通过物理线路的连接，动态地分配传输线路资源

电路交换的过程:

①建立连接(尝试占用通信资源)

②)通信(一直占用通信资源)

③释放连接(归还通信资源)

![[Pasted image 20250715135829.png]]

#### 报文交换

思想:把传送的数据单元先存储进中间节点，再根据目的地址转发至下一节点。

![[Pasted image 20250715135837.png]]

#### 分组交换

![[Pasted image 20250715135844.png]]

![[Pasted image 20250715135853.png]]

分组交换时中间节点一定要接收完整个分组后,才能解析并转发

![[Pasted image 20250715135858.png]]

## 计算机网络的分类

![[Pasted image 20250715135905.png]]

#### 按分布范围分类

![[Pasted image 20250715135913.png]]

#### 按传输技术分类

广播式网络--当一台计算机发送数据分组时，广播范围内所有计算机都会收到该分组，并通过检查分组的目的地址决定是否接收该分组(E.G.所有无线网络WIFI都是广播式的)

点对点网络--数据只会从发送方“点对点”发到接收方，精准送达(E.G.路由器转发数据分组是点对点的)

#### 按拓扑结构分类

![[Pasted image 20250715135926.png]]
总线形结构在总线中存在正在传输的数据时,其他设备再去传输就会造成错误,而环形结构只允许一个设备使用总线

## 标准化工作

![[Pasted image 20250715135932.png]]

![[Pasted image 20250715135938.png]]

但是RFC不一定是因特网标准

草案要发送到指定邮箱审核

审核通过后将自己的草案开放让其他人去进行修改和建议,之后再经过IEFT和IAB的审核就可以成为因特网标准了

![[Pasted image 20250715135945.png]]

## 性能指标

#### 速率

速率即数据率或称数据传输率或比特率,是连接在计算机网络上的主机在数字信道上传送数据位数的速率,单位是b/s，kb/s，Mb/s，Gb/s，Tb/s

> 比特是数据量的单位,表现形式为1或0,单位为位

![[Pasted image 20250715135952.png]]

在形容速率的时候,这些单位之间相差1000倍,但是在形容存储容量时进制为1024(2^100),速率的b为小写,容量的B为大写

#### 带宽

“带宽”原本指某个信号具有的频带宽度，即最高频率与最低频率之差，单位是赫兹(Hz)

计算机网络中，带宽用来表示网络的通信线路传送数据的能力，通常是指单位时间内从网络中的某一点到另一点所能通过的“最高数据率”,即网络设备所支持的最高速度。单位是“比特每秒”，b/s，kb/s，Mb/s，Gb/s。(带宽是理想值,一般不会到达带宽值)

> bit在链路上传播的速度是不会变的,带宽影响的是发送的速度

#### 吞吐量

表示在单位时间内通过某个网络(或信道、接口)的数据量。单位b/s，kb/s，Mb/s等。吞吐量受网络的带宽或网络的额定速率的限制。

#### 时延

![[Pasted image 20250715140001.png]]
在进入转换机前和处理后都会经过一个排队时延

#### 时延带宽积

![[Pasted image 20250715140007.png]]

#### 往返时延RTT

![[Pasted image 20250715140013.png]]

#### 利用率

![[Pasted image 20250715140019.png]]

利用率过大反而会影响传输速率

## 计网体系结构

![[Pasted image 20250715140025.png]]

![[Pasted image 20250715140034.png]]

![[Pasted image 20250715140040.png]]

协议是水平的,只有对等实体之间才有协议

#### OSI七层体系结构

![[Pasted image 20250715140046.png]]

![[Pasted image 20250715140055.png]]

在中间系统中会把数据解析一次,之后才会发到下一个位置,是点到点的(他们不知道这条消息最后要去哪里,只知道下一次要到哪里),而客户端之间是端到端的(他们不知道中间要经过那些中间系统,只知道最后会到哪里)

![[Pasted image 20250715140103.png]]

通信过程中数链路层不仅会对数据加一个头部,还会额外添加一个尾部,而物理层只是把数据转化为二进制,并不会添加任何东西

![[Pasted image 20250715140109.png]]

应用层主要是指需要联网才能使用的一些应用程序

应用层的常见协议

1. 文件传输(FTP)
    
2. 电子邮件(SMTP)
    
3. 万维网(HTTP)
    

表示层用于处理在两个通信系统中交换信息的表示方式(语法和语义)

功能一:数据格式变换

功能二:数据加密解密

功能三:数据压缩和恢复

常见协议有JPEG,ASCII等

会话层负责向表示层实体/用户进程提供已经建立的连接并在连接上有序地传输数据,这些功能叫做会话,也叫建立同步.

功能一:建立、管理、终止会话

功能二:使用校验点可使会话在通信失效时从校验点/同步点继续恢复通信，实现数据同步。适用于传输大文件。

主要协议:ADSP、ASP

传输层负责 主机中两个进程的通信，即端到端的通信。传输单位是报文段或用户数据报

功能一:可靠传输(确认机制)、不可靠传输(不需要建立连接)

功能二:差错控制

功能三:流量控制(控制发送端的发送速率)

功能四:复用分用

> 复用:多个应用层进程可同时使用下面运输层的服务。
> 
> 分用:运输层把收到的信息分别交付给上面应用层中相应的进程

主要协议:TCP,UDP

网络层的主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。

网络层传输单位是数据报(数据报切割后变为分组)

功能一:路由选择(选择最佳路由方式)

功能二:流量控制

功能三:差错控制

功能四:拥塞控制(对整个传输过程进行总体的限制)

> 若所有结点都来不及接受分组，而要丢弃大量分组的话，网络就处于拥塞状态。因此要采取一定措施缓解这种拥塞。

主要协议:IP、IPX、ICMP、IGMP、ARP、RARP、OSPF

数据链路层的主要任务是把网络层传下来的数据报组装成帧,数据链路层/链路层的传输单位是帧

功能一:成帧(定义帧的开始和结束)

....1000011101010101.....

功能二:差错控制 帧错+位错(支持修改和丢弃)

功能三:流量控制

功能四:访问(接入)控制控制对信道的访问(在广播式链路中)

主要协议:SDLC、HDLC、PPP、STP

物理层的主要任务是在物理媒体上实现比特流的透明传输

物理层传输单位是比特

> 透明传输:指不管所传数据是什么样的比特组合,都应当能够在链路上传送。

功能一:定义接口特性

功能二:定义传输模式 单工(发送方和接受方是确定好的)、半双工(双方都可以是发送方或接收方,但是同时只能有一方发送数据)、双工(可以双向同时传输)

功能三:定义传输速率(百兆网)

功能四:比特同步(保证比特的一致性)

功能五:比特编码(确定什么电位是1)

主要协议:Rj45、802.3

#### TCP/IP参考模型

![[Pasted image 20250715140120.png]]

先有协议栈,再有的模型

与OSI的相同点:

1.都分层

2.基于独立的协议栈的概念

3.可以实现异构网络互联

不同点:

1. OSI定义三点:服务、协议、接口
    
2. OSI先出现，参考模型先于协议发明，不偏向特定协议
    
3. TCP/IP设计之初就考虑到异构网互联问题，将IP作为重要层次
    
![[Pasted image 20250715140128.png]]

> 面向连接分为三个阶段，第一是建立连接，在此阶段，发出一个建立连接的请求。只有在连接成功建立之后，才能开始数据传输，这是第二阶段,接着，当数据传输完毕，必须释放连接。而面向无连接没有这么多阶段，它直接进行数据传输。(IP协议强调无连接)

#### 五层参考模型(考研用)

![[Pasted image 20250715140135.png]]

![[Pasted image 20250715140141.png]]

应用层先在原始信息上加上一些额外信息形成报文,报文被切割后,被加上传输层的控制及协议,形成报文段,之后加上网络层控制协议形成数据报,数据报过长时可以切分为多个分组,然后在链路层组成帧并加上头尾,最后由物理层转为比特进行传输

## 物理层

![[Pasted image 20250715140147.png]]

物理层解决如何在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。

物理层主要任务:确定与传输媒体接口有关的一些特性 -> 定义标准

#### 标准

![[Pasted image 20250715140154.png]]

#### 数据通信

![[Pasted image 20250715140159.png]]

![[Pasted image 20250715140205.png]]

#### 通信方式

从通信双方信息的交互方式看，可以有三种基本方式:

1. 单工通信: 只有一个方向的通信而没有反方向的交互，仅需要一条信道
    
2. 半双工通信/双向交替通信: 通信的双方都可以发送或接收信息，但任何一方都不能同时发送和接收，需要两条信道。
    
3. 全双工通信/双向同时通信: 通信双方可以同时发送和接受信息，也需要两条信道，
    

![[Pasted image 20250715140212.png]]

![[Pasted image 20250715140219.png]]

#### 码元

![[Pasted image 20250715140224.png]]

数字脉冲中的每一个横段都是一个码元,持续的时间称为码元宽度,其有几种电平则为几进制码元(如图中有0和1两种电平,所以是二进制码元),如果一段二进制码元想要表示一段十六进制的码元.那么翻译时就需要四段二进制码元,所以一段16进制码元携带的比特数为4,即一段K进制码元可以携带的比特数为log2K

#### 数字通信系统中的传输速率

速率也叫数据率，是指数据的传输速率，表示单位时间内传输的数据量。可以用码元传输速率和信息传输速率表示。

1. 码元传输速率:别名码元速率、波形速率、调制速率、符号速率等，它表示单位时间内数字通信系统所传输的码元个数(也可称为脉冲个数或信号变化的次数)，单位是波特(Baud,B)。1波特表示数字通信系统每秒传输一个码元。
    

> 数字信号有多进制和二进制之分，但码元速率与进制数无关，只与码元长度T有关。

码元速率和码元长度的关系
![[Pasted image 20250715140508.png]]
2. 信息传输速率:别名信息速率、比特率等，表示单位时间内数字通信系统传输的二进制码元个数(即比特数),单位是比特/秒(b/s)。
    

关系:若一个码元携带n bit的信息量，则M Baud的码元传输速率所对应的信息传输速率为M*n bit/s。

在比较哪一个信息系统传输速率时一般比较的是信息传输速率

#### 带宽

1. 模拟信号系统中:当输入的信号频率高或低到一定程度，得系统的输出功率成为输入功率的一半时(即-3dB)，最高频率和最低频率间的差值就代表了系统的通频带宽，其单位为赫兹(Hz)。
    
2. 数字设备中:表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”/单位时间内通过链路的数量，常用来表示网络的通信线路所能传输数据的能力。单位是比特每秒(bps)。
    
#### 奈氏准则

**影响失真程度的因素:**

1. 码元传输速率
    
2. 信号传输距离
    
3. 噪声干扰
    
4. 传输媒体质量
    

信道带宽是信道能通过的最高频率和最低频率之差。

码间串扰:接收端收到的信号波形失去了码元之间清晰界限的现象(即码元传输过快,接收端无法区分各个码元)

奈氏准则:在理想低通(无噪声，带宽受限)条件下，为了避免码间串扰，极限码元传输速率为2W Baud，w是信道带宽，单位是Hz。

> 低通即低于最高频率的信号都可以通过

![[Pasted image 20250715140705.png]]
推论:

1. 在任何信道中，码元传输的速率是有上限的。若传输速率超过此上限，就会出现严重的码间串扰问题，使接收端对码元的完全正确识别成为不可能。
    
2. 信道的频带越宽(即能通过的信号高频量越多或者说带宽越大)，就可以用更高的速率进行码元的有效传输。
    
3. 奈氏准则给出了码元传输速率的限制，并没有对信息传输速率给出限制。
    
4. 由于码元的传输速率受奈氏准则的制约,所以要提高数据的传输速率，就必须设法使每个码元能携带更多个比特的信息量，这就需要采用多元制的调制方法
    

#### 香农定理

信噪比原来是没有单位的,化为dB只是表达形式不同,但数值是相同的,类似1000 = 1k
![[Pasted image 20250715140718.png]]
推论:
![[Pasted image 20250715140728.png]]
#### 编码与调制
![[Pasted image 20250715140737.png]]
![[Pasted image 20250715140743.png]]
![[Pasted image 20250715140748.png]]
**数字数据编码为数字信号**
![[Pasted image 20250715140758.png]]
![[Pasted image 20250715140803.png]]
![[Pasted image 20250715140807.png]]
![[Pasted image 20250715140815.png]]
![[Pasted image 20250715140820.png]]
![[Pasted image 20250715140828.png]]
![[Pasted image 20250715140834.png]]
**数字数据调制为****模拟信号**
![[Pasted image 20250715140853.png]]
**模拟数据****编码为数字信号**
![[Pasted image 20250715140903.png]]
**模拟数据****调制为****模拟信号**

为了实现传输的有效性，可能需要较高的频率。这种调制方式还可以使用频分复用技术，充分利用带宽资源。在电话机和本地交换机所传输的信号是采用模拟信号传输模拟数据的方式:模拟的声音数据是加载到模拟的载波信号中传输的。

#### 数据交换方式

**电路交换**
![[Pasted image 20250715140923.png]]
![[Pasted image 20250715140929.png]]
**报文交换**
![[Pasted image 20250715140942.png]]
![[Pasted image 20250715140947.png]]
**分组交换**
![[Pasted image 20250715140956.png]]
![[Pasted image 20250715141000.png]]
![[Pasted image 20250715141005.png]]
分组交换又有数据包方式和虚电路方式
![[Pasted image 20250715141014.png]]
![[Pasted image 20250715141020.png]]
![[Pasted image 20250715141026.png]]
![[Pasted image 20250715141031.png]]
![[Pasted image 20250715141036.png]]
#### 传输介质及分类
![[Pasted image 20250715141046.png]]
![[Pasted image 20250715141051.png]]
## 数据链路层
![[Pasted image 20250715141103.png]]
#### 基本概念
![[Pasted image 20250715141115.png]]
![[Pasted image 20250715141119.png]]
对于有确认面向连接服务，只有当发送端收到上一个帧的确认信息才会发送下一帧

#### 封装成帧和透明传输
![[Pasted image 20250715141130.png]]
![[Pasted image 20250715141135.png]]
1. **字符计数法**
![[Pasted image 20250715141145.png]]
帧内字符数是包含帧首部的计数字段的，这种方法只要有一个帧的计数字段出现问题就会导致后边的所有帧都错，所以不常用

2. **字符填充法**
![[Pasted image 20250715141157.png]]
![[Pasted image 20250715141202.png]]
这种方法是在帧的首尾添加字节来标识帧的起始和结束的，如果帧内有和首和尾同义的字符时，就加另一种字节ESC，大致就是在原帧中把所有SOH，EOT和ESC同义的字段之前都加一个ESC字段（如两个同义与ESC字段的数据本来就在一块，那么就会变成4个ESC在一块）

但是这种方法实现较为困难所以也不常用

3. **零比特传输法**
![[Pasted image 20250715141212.png]]
对于本身就是111110的也要加，变为1111100

4. **违规编码法**
    

#### 差错控制
![[Pasted image 20250715141224.png]]
![[Pasted image 20250715141230.png]]
**检错编码**

1. 奇偶校验码
![[Pasted image 20250715141240.png]]
奇偶校验码校验的是1的个数

2. CRC循环冗余码
![[Pasted image 20250715141249.png]]
生成多项式实际上就是一个多项式，如x^3+x^2+1,即1*x^3+1*x^2+0*x+1*x^0,也可以表示为1101
![[Pasted image 20250715141259.png]]
![[Pasted image 20250715141304.png]]
**纠错编码**

 3. 海明码
![[Pasted image 20250715141314.png]]
海明距离
![[Pasted image 20250715144254.png]]
要检验d位错误,海明距离至少为d+1,要纠正d位错误则至少为2d+1,所以可以发现双比特错,但是只能修改单比特错
![[Pasted image 20250715144329.png]]
![[Pasted image 20250715144341.png]]
![[Pasted image 20250715144346.png]]
![[Pasted image 20250715144352.png]]
画三个圆,先把各位校验码代表的位数填进每一个圆圈中,在把每两个圆圈中的夹缝放入这两个圆中的数的和,最后在最中间填这三个位数的和,这样就可以看出来哪一位出错了
![[Pasted image 20250715144404.png]]
#### 流量控制
![[Pasted image 20250715144413.png]]
**方法**
![[Pasted image 20250715144423.png]]
![[Pasted image 20250715144427.png]]
![[Pasted image 20250715144432.png]]
1. 停止-等待协议
![[Pasted image 20250715144444.png]]
![[Pasted image 20250715144450.png]]
![[Pasted image 20250715144455.png]]
数据帧和确认帧编号可以防止接收方收到同样的帧,接收方收到的帧如果发现有错误也不会返回确认帧,会等待重传
![[Pasted image 20250715144506.png]]
![[Pasted image 20250715144510.png]]
![[Pasted image 20250715144516.png]]
![[Pasted image 20250715144522.png]]
单向传播时延在这道题中就是1/2 T(因为没有说确认帧的发送时延)

2. 后退n帧协议(GBN)
![[Pasted image 20250715144531.png]]
帧的编号规则(所以帧的编号是重复的)
![[Pasted image 20250715144541.png]]
![[Pasted image 20250715144547.png]]
![[Pasted image 20250715144553.png]]
![[Pasted image 20250715144559.png]]
![[Pasted image 20250715144603.png]]
为什么叫“后退N帧协议”?

原本已经发送了1号帧，现在却“后退”回0号帧重新传送,这样即可实现“流量控制’
![[Pasted image 20250715144614.png]]
![[Pasted image 20250715144619.png]]
3. 选择重传协议(SR)
![[Pasted image 20250715144629.png]]
>要让发送窗口大于等于接收窗口主要是因为不这样的话接收窗口大于发送窗口的部分利用率会很低,通常会让两者大小相等

![[Pasted image 20250715144640.png]]
![[Pasted image 20250715144645.png]]
如图,如果一组帧之间有帧传输失败,那么接受窗口和发送窗口就都只会滑动一格到发送失败的那个帧,发送失败的帧会等待超时重传,新进入窗口的帧会正常发送,之前成功发送过的帧也不会再次重传了
![[Pasted image 20250715144658.png]]
如果确认帧丢失的话,超时重发的已接收帧会因为不在接收窗口范围内(n位bit编码限制的作用)而被拒收,重发对应的ack帧
![[Pasted image 20250715144708.png]]
**信道****利用率的计算**
![[Pasted image 20250715144719.png]]
**术语补充**
![[Pasted image 20250715144728.png]]
![[Pasted image 20250715144738.png]]
#### 介质访问控制
![[Pasted image 20250715144747.png]]
![[Pasted image 20250715144752.png]]
1. **时分复用**
![[Pasted image 20250715144802.png]]
2. **统计****时分复用**
![[Pasted image 20250715144813.png]]
3. **频分复用**
![[Pasted image 20250715144826.png]]
4. **波分复用(即光的频分复用)**
![[Pasted image 20250715144836.png]]
5. 码分复用
![[Pasted image 20250715144846.png]]
![[Pasted image 20250715144851.png]]
![[Pasted image 20250715144855.png]]
#### 随机访问
![[Pasted image 20250715144904.png]]
![[Pasted image 20250715144909.png]]
1. ALOHA
![[Pasted image 20250715144919.png]]
![[Pasted image 20250715144926.png]]
![[Pasted image 20250715144930.png]]
2. CMSA
![[Pasted image 20250715144940.png]]
1-坚持CMSA协议
![[Pasted image 20250715144952.png]]
非坚持CMSA协议
![[Pasted image 20250715145001.png]]
p-坚持CSMA协议
![[Pasted image 20250715145010.png]]
**CSMA/CD协议**
![[Pasted image 20250715145019.png]]
不需要ack主要是因为CSMA/CD的常用场景是有线网络,误码率较低
![[Pasted image 20250715145035.png]]
检测到冲突后冲突的双方都会停止并尝试重发

争用期
![[Pasted image 20250715145045.png]]
最短帧长
![[Pasted image 20250715145057.png]]
最短帧长主要是为了防止在其他节点发出的信号已经与自己的冲突但是因为自己发送的帧比较短,在冲突信号传达之前就发完而检测不出自己是冲突的情况
![[Pasted image 20250715145110.png]]
CSMA/CA协议
![[Pasted image 20250715145118.png]]
![[Pasted image 20250715145125.png]]
![[Pasted image 20250715145129.png]]
![[Pasted image 20250715145134.png]]
![[Pasted image 20250715145140.png]]
#### 轮询访问
![[Pasted image 20250715145154.png]]
![[Pasted image 20250715145159.png]]
获得令牌帧的节点会将其转化为数据帧,数据帧会在环路中转一圈
![[Pasted image 20250715145211.png]]
每个节点会检查目的是否为自己,是则将数据复制一份并修改已接收字段为true,不是则不接收,如果接收端因为检验帧为错等原因拒收,则数据帧回到发送端时仍为false,此时就会尝试重发(有上限).如果为true,则将数据帧还原为令牌帧
![[Pasted image 20250715145225.png]]
还原后的数据帧会把令牌号变为下一个节点的编号,并且拿到一次令牌帧就只能传输一个数据帧,之后就要传递给下一个节点,接收到令牌帧后会检查是否和自己的编号一致,一致则会获取令牌帧,如果不需要传输数据则会直接把令牌号改为下一个节点的编号直接交给下一个节点
![[Pasted image 20250715145238.png]]
#### 局域网与IEEE(国际组织)
![[Pasted image 20250715145248.png]]
![[Pasted image 20250715145253.png]]
#### 以太网
![[Pasted image 20250715145301.png]]
**物理层标准**
![[Pasted image 20250715145312.png]]
**介质访问控制子层(MAC)标准**
![[Pasted image 20250715145321.png]]
IEEE的标准中没有协议类型这一信息,替代的是数据的具体长度(也是2字节),因为在IEEE的标准分层中确定协议是在逻辑链路控制子层中实现的,而这一层在v2中并没有

一个链路层数据帧能承载的最大数据量称为最大传送单元(MTU),如以太网的MTU=1500B

**单播帧和广播帧的传播**
![[Pasted image 20250715145332.png]]
其中路由器负责的有网络层,数据链路层和物理层,交换机为数据链路层和物理层,集线器则只有物理层,所以路由器和交换机都会有一个甚至多个mac地址

集线器会把自己收到的信号转发给连接给自己的所有节点,由节点决定是否接受,如E发给F的信号被交换机接受后,他会发现目的地和发送者用走的同一个链路,所以也不会在转发回去
![[Pasted image 20250715145343.png]]
#### VLAN(虚拟局域网)
![[Pasted image 20250715145354.png]]
![[Pasted image 20250715145400.png]]
**vlan****的划分方式:**

1. 基于接口
![[Pasted image 20250715145410.png]]
2. 基于MAC地址
![[Pasted image 20250715145420.png]]
不同于基于接口的方式只记录当前交换机的接口和vid的映射,mac地址的映射是同一个vlan下的所有mac地址归于一个vlan,如H和I,交换机知道他们应该从那个接口转发出去

3. 基于ip地址
![[Pasted image 20250715145430.png]]
**802.1Q帧的作用**
![[Pasted image 20250715145441.png]]
如图,这种帧主要是用来告知其他交换机这条消息是来自那个vlan的
![[Pasted image 20250715145452.png]]
插入vlan标签后,CRC验错码需要重新生成

## 网络层
![[Pasted image 20250715145504.png]]
#### 功能
![[Pasted image 20250715145513.png]]
#### IPV4分组
![[Pasted image 20250715145522.png]]
![[Pasted image 20250715145528.png]]
![[Pasted image 20250715145533.png]]
实际上因为链路层存在MTU(以太网为1500B),所以如果一个IP数据报的总长度超出了下一段链路的MTU,就需要分片
![[Pasted image 20250715145547.png]]
![[Pasted image 20250715145556.png]]
![[Pasted image 20250715145603.png]]
![[Pasted image 20250715145608.png]]
其中片偏移表示数据部分在“被分片前”的位置,以 x 8B 为单位
![[Pasted image 20250715145619.png]]
![[Pasted image 20250715145624.png]]
减到0后立刻丢弃,不再转发
![[Pasted image 20250715145633.png]]
#### IP地址

**最初的****IP****地址分类**
![[Pasted image 20250715145643.png]]
**IP分组转发**
![[Pasted image 20250715145655.png]]
默认网关就是路由器的ip,即每台主机访问互联网时要经过的ip,每台主机在发送信息时,会先检查网络号是否和自己一致,不一致则通过arp协议获取路由器的mac地址,转发给路由器后发往对应的路由器或公网,如果一致则直接获取对应主机的mac,不再经过路由器

**特殊的****IP****地址**
![[Pasted image 20250715145705.png]]
>Y表示有(为任意值)

1. 有网络号且主机号全1的ip被对应网络接收后就会广播给目的网络下的所有主机
    
2. 全0和全1的ip主要用于DHCP协议(用于刚接入路由器的设备),因为刚接入的设备没有ip地址,他就会以源地址为0.0.0.0,目的地址为255.255.255.255发送一个本网络内的广播(DHCP报文),每一个网络内会有一个DHCP服务器,它接收到这种消息后就会返回一个DHCP报文告诉新主机的ip是多少,这台新主机接收到后就有了自己的ip(当然全1也可以正常用作网络内广播)
    
3. 127.x.x.x被A类和B类跳过了,留作专用
    
4. 以上这些ip都不能分配给任何一个主机或路由器私用
#### 子网划分技术
![[Pasted image 20250715145744.png]]
![[Pasted image 20250715145749.png]]
![[Pasted image 20250715145756.png]]
#### CIDR
![[Pasted image 20250715145804.png]]
![[Pasted image 20250715145808.png]]
可以看出子网号的划分遵循哈夫曼编码的规则,所以不会有两个子网对一个ip进行网络号计算时都匹配的情况
![[Pasted image 20250715145819.png]]
#### 路由聚合
![[Pasted image 20250715145828.png]]
![[Pasted image 20250715145834.png]]
![[Pasted image 20250715145840.png]]
存在路由聚合的原因是因为每个路由器都有一个路由表,但是因为路由器与路由器之间的线路一般不会单独分配ip,所以需要在上级路由器中存储下级路由器中的所有路由表,这会造成很大的重复,所以可以把多个路由聚合为一个(同时也是分配给子路由的ip段,所以可以认为当路由器与路由器相连时,对应的接口ip就是分配的ip段)

引入无效地址是指子路由器被分配的ip段中可能有部分并没有分配,但是由于路由聚合还是会被转发到子路由器上,不过这时子路由器会因为这条消息的出口和入口相同而被丢弃,所以不影响工作

**最长前缀匹配原则**
![[Pasted image 20250715145853.png]]
如果存在图中这种存在多条路线的情况,路由器会选择前缀相等位数最多的那一个接口转发

#### 网络地址转换(NAT)
![[Pasted image 20250715145903.png]]
![[Pasted image 20250715145908.png]]
![[Pasted image 20250715145913.png]]
#### 地址解析协议(ARP)
![[Pasted image 20250715145924.png]]
**ARP****的过程**
![[Pasted image 20250715145933.png]]
主机首先发送一个目的地址全1的广播mac帧,写明自己的ip和mac地址以及想找的mac地址的主机的ip,目的主机会返回一个单播消息,此时双方就会各自把对方的ip和mac地址都记录下来
![[Pasted image 20250715145944.png]]
#### 动态主机配置协议(DHCP)
![[Pasted image 20250715145955.png]]
![[Pasted image 20250715150002.png]]
第三次request还是使用广播的原因是因为一个网络中可能有多个DHCP服务器,所以在第一次广播中会有多个DHCP服务器都收到申请,这样就会返回多个offer,所以申请方需要再次广播来通知所有DHCP服务器自己选用的ip是哪一个

#### 路由算法和路由协议

## ARP协议
![[Pasted image 20250715140534.png]]

逻辑同网段才能发送ARP

ARP请求广播，ARP应答单播

ARP本质是查找下一跳的MAC地址,而不是请求目标地址

#### 免费ARP

即不需要特定终端发起ARP请求广播,自己向所有终端发起ARP应答,便于其他终端将自己的mac地址添加到缓存中,提高增加设备时的效率(如添加ip时会发起一个免费ARP用以检测ip是否重复)

#### ARP代理

即拦截一个ARP请求并将其发往另一个地方,作用就类似于正常的网络代理

## IP协议

ip协议存在的目的是为了兼容一些不支持mac地址的设备,他是互联网通用的唯一标识

## NAT

![[Pasted image 20250715140545.png]]

即内网的ip可以相同,但是其暴露在公网的ip却是唯一的,他们之间就是通过NAT关联到一起的,这样做可以节约ipv4地址

## 数据包

![[Pasted image 20250715140551.png]]

#### 发送

![[Pasted image 20250715140559.png]]

## DNS

用于简化ip地址的记忆

#### 解析过程

1. 客户端发www.douyin.com的解析请求
    
2. 递归解析器去问 "."(根) ,com.去哪里解析
    
3. 递归解析器去问"com."(顶级域名) ,douyin.com去哪里解析
    
4. douyin.com告诉递归解,www.douyin.com解析到xxx
    

![[Pasted image 20250715140605.png]]

## UDP

![[Pasted image 20250715140610.png]]

## TCP

Tcp连接是一种状态,而不是具体的连接

最大报文段长度（MSS: Maximum Segment Size）表示TCP传往另一端的最大块数据的长度。当一个连接建立时，连接的双方都要通告各自的MSS。

通常TCP通信的双方协商这个值，以避免TCP分片。

TCP在握手时有一个operation的字段,客户端和服务端的MSS都会向里边填,然后会找一个最小的值作为MSS的值,operation中还有一个timestamp,这些属性都是在握手阶段交互的

sequence number:表示的是我方(发送方)这边，这个packet的数据部分的第一位应该在整个data stream中所在的位置。

acknowledge number:表示的是期望的对方(接收方)的下一次sequence number是多少.注意，SYN/FIN的传输虽然没有data，但是会让下一次传输的packet seq增加一，但是，ACK的传输，不会让下一次的传输packet加一

![[Pasted image 20250715140617.png]]